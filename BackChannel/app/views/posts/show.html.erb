<p id="notice"><%= notice %></p>

<div style="text-align: center;">
  <table>
    <tr>
     <td>
       <b><%= @post.content %> &nbsp;&nbsp;<i>by <%= @post.user.username %> &nbsp;&nbsp;&nbsp;</i> </b>   <!-- Vote for the post -->
     </td>
     <td>
        <%=
            voters = Vote.find_by_sql("select user_id, username from votes join users where votes.user_id = users.id and votes.post_id= " + @post.id.to_s)

            has_current_user_voted = false
            voters.each do |voter|
              if voter[:user_id] == return_current_user
                puts voter[:user_id]
                has_current_user_voted = true
              end
            end

            return_string = ""
            if has_current_user_voted == false
              return_string = voters.size.to_s + " users have voted for this post"
            elsif
            return_string = "You and " + (voters.size - 1).to_s + " users have voted for this post"
            end
            return_string
        %>
      </td>
      <td>
        &nbsp;&nbsp;&nbsp;
        <% unless current_user.id == @post.user_id %>
            <%= link_to 'Vote', :controller => "votes", :action => "new", :post_id => @post.id %>
        <% end %>
      </td>
    </tr>
  </table>
</div>
<br>
<div>
    <div style="border: 1px">
    <table>
      <tr>
        <td>
          <table>
          <% @post.comments.each do |comment| %>
                <tr>
                  <td>
                    <div style="margin-bottom: 15px;"><%= comment.content %> <i>by <%= comment.user.username %></i> </div>
                  </td>
                  <td>
                    <!--%=
                    voters = Vote.find_by_sql("select user_id, username from votes join users where votes.user_id = users.id and votes.comment_id= " + @post.id.to_s)

                    has_current_user_voted = false
                    voters.each do |voter|
                    if voter[:user_id] == return_current_user
                        puts voter[:user_id]
                     has_current_user_voted = true
                    end
                   end

                    return_string = ""
                    if has_current_user_voted == false
                   return_string = voters.size.to_s + " users have voted for this post"
                     elsif
                  return_string = "You and " + (voters.size - 1).to_s + " users have voted for this post"
                     end
                  return_string
                           % -->
                  </td>
                  <td>
                    <% unless current_user.id == comment.user_id %>
                        <div style="margin-bottom: 15px;"><%= link_to 'Vote', :controller => "votes", :action => "new", :comment_id => comment.id %></div>
                    <% end %>
                  </td>
                </tr>
                <tr>
                      <% unless current_user.id != comment.user_id %>
                      <div style = "margin-left: 30px;">
                        <table>
                          <tr>
                            <td><%= link_to 'Edit Comment', edit_comment_path(:id => comment.id,:post_id =>@post.id)  %></td>
                            <td>&nbsp;&nbsp;</td>
                            <td><%= link_to 'Delete Comment', [comment.post, comment], method: :delete, data: { confirm: 'Are you sure?' } %></td>
                          </tr>
                        </table>
                      </div>
                      <% end %>
                </tr>
                <tr>&nbsp;&nbsp;</tr> <tr>&nbsp;&nbsp;</tr> <tr>&nbsp;&nbsp;</tr> <tr>&nbsp;&nbsp;</tr>
          <% end %>
          </table>
          <br>
        </td>
      </tr>
      <tr>
      <% unless current_user.id == @post.user_id %>
      <%= form_for([@post, @post.comments.build]) do |f| %>
              <td>
                <div style="margin-left: 25px;" class="field">
                  <%= f.text_field :content %>
                </div>
              </td>
              <td>
                <div class="actions">
                  <%= f.submit %>
                </div>
              </td>
        <% end %>
       </tr>
        <% end %>
      </table>
    </div>
</div>
<br>

<div>
  <% unless current_user.id == @post.user_id %>
    <%= link_to 'Edit Post', edit_post_path(@post) %>
  <% end %>
  <%= link_to 'Back to all Posts', posts_path %>
</div>

